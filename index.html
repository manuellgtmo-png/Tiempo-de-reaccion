<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiempo de Reacción - Terapia Visual</title>
    <style>
        :root { --bg: #0f172a; --accent: #38bdf8; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        #setup-screen, #instruction-screen { position: fixed; inset: 0; background: var(--bg); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .input-clinico { padding: 12px; font-size: 1rem; border-radius: 8px; border: 2px solid var(--accent); background: #1e293b; color: white; margin: 10px; width: 280px; }
        .btn-grande { background: var(--accent); color: #0f172a; padding: 15px 35px; border-radius: 12px; font-size: 1.5rem; font-weight: bold; cursor: pointer; border: none; margin-top: 20px; }
        .header { padding: 10px; border-bottom: 1px solid #334155; width: 100%; text-align: center; background: rgba(15, 23, 42, 0.9); }
        #game-canvas { position: relative; width: 100vw; height: calc(100vh - 80px); }
        .target { position: absolute; width: 80px; height: 80px; border-radius: 50%; display: none; cursor: pointer; transform: translate(-50%, -50%); box-shadow: 0 0 20px rgba(255,255,255,0.3); }
    </style>
</head>
<body>
    <div id="setup-screen">
        <h1 style="color:var(--accent)">TIEMPO DE REACCIÓN</h1>
        <input type="text" id="nombrePaciente" class="input-clinico" placeholder="Nombre del Paciente">
        <button class="btn-grande" onclick="irAInstrucciones()">Siguiente</button>
    </div>
    <div id="instruction-screen" style="display:none">
        <h2 style="color:var(--accent)">Instrucciones</h2>
        <p>Toca los círculos lo más rápido posible.<br>La sesión termina a los 10 aciertos.</p>
        <button class="btn-grande" onclick="comenzarJuego()">¡Empezar!</button>
    </div>
    <div class="header">
        <span>Paciente: <b id="val-pac">---</b></span> | <span>Promedio: <b id="val-avg">0</b> ms</span> | <span>Aciertos: <b id="val-hits">0</b>/10</span>
    </div>
    <div id="game-canvas"><div id="target" class="target" onmousedown="acierto(event)"></div></div>

    <script>
        let paciente = "", startTime, times = [], hits = 0;
        const target = document.getElementById('target');

        function irAInstrucciones() {
            paciente = document.getElementById('nombrePaciente').value.trim();
            if(!paciente) return alert("Ingrese el nombre");
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('instruction-screen').style.display = 'flex';
        }

        function comenzarJuego() {
            document.getElementById('instruction-screen').style.display = 'none';
            document.getElementById('val-pac').innerText = paciente;
            aparecer();
        }

        function aparecer() {
            if (hits >= 10) return finalizarSesion();
            const x = Math.random() * (window.innerWidth - 100) + 50;
            const y = Math.random() * (window.innerHeight - 180) + 50;
            target.style.left = x + "px"; target.style.top = y + "px";
            target.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 60%)`;
            target.style.display = "none";
            setTimeout(() => { target.style.display = "block"; startTime = Date.now(); }, Math.random() * 2000 + 500);
        }

        function acierto(e) {
            e.stopPropagation();
            times.push(Date.now() - startTime);
            hits++;
            target.style.display = "none";
            document.getElementById('val-hits').innerText = hits;
            document.getElementById('val-avg').innerText = Math.round(times.reduce((a, b) => a + b) / times.length);
            aparecer();
        }

        function finalizarSesion() {
            const promedio = document.getElementById('val-avg').innerText + " ms";
            const URL_FORM = "https://docs.google.com/forms/d/e/1FAIpQLScIgP6SFKo8ACneK7EdifzxCyl8haYU7LLIys1NxjIiUklkWA/formResponse";
            
            const formData = new FormData();
            formData.append("entry.1971645483", paciente);
            formData.append("entry.1310127986", "Tiempo de Reacción");
            formData.append("entry.1881234158", "Finalizado");
            formData.append("entry.2029359389", hits);
            formData.append("entry.2036354186", "0");
            formData.append("entry.934609722", promedio);
            formData.append("entry.143370750", new Date().toLocaleDateString());

            fetch(URL_FORM, { method: "POST", mode: "no-cors", body: formData })
            .then(() => { alert("Datos enviados. Promedio: " + promedio); location.reload(); });
        }
    </script>
</body>
</html>

